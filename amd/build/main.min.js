define(["jquery","core/templates","filter_ally/ally","filter_ally/imagecover","filter_ally/util"],function(a,b,c,d,e){return new function(){var f=this;f.canViewFeedback=!1,f.canDownload=!1;var g=function(c,d,e){c.canviewfeedback=f.canViewFeedback,c.candownload=f.canDownload,c.html='<span id="content-target-'+d+'"></span>',b.render("filter_ally/wrapper",c).done(function(b){a(e).after(b),a("#content-target-"+d).after(e),a("#content-target-"+d).remove()})},h=function(b){a(document).ready(function(){e.whenTrue(function(){return a('div[id*="assign_files_tree"] .ygtvitem').length>0},10).done(function(){a('div[id*="assign_files_tree"] a[href*="pluginfile.php"]').each(function(){var c,d=a(this).attr("href");c=d.indexOf("?")>-1?/pluginfile.php\/(\d*)\/(.*)(\?)/:/pluginfile.php\/(\d*)\/(.*)/;var e=d.match(c),f=e[1]+"/"+e[2];f=decodeURIComponent(f);var h=b[f],i={isimage:!1,fileid:h,url:d};g(i,h,a(this))})})})},i=function(b){a(document).ready(function(){for(var c in b){var d=b[c],e=a("#module-"+c+" .activityinstance"),f={isimage:!1,fileid:d,url:a(e).attr("href")};g(f,d,e)}})};this.init=function(a,b,e){f.canViewFeedback=b,f.canDownload=e,(b||e)&&(Object.keys(ally_module_maps.file_resources).length>0&&i(ally_module_maps.file_resources),Object.keys(ally_module_maps.assignment_files).length>0&&h(ally_module_maps.assignment_files)),c.init(a),d.init()}}});