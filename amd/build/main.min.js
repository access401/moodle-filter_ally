define(["jquery","core/templates","filter_ally/ally","filter_ally/imagecover"],function(a,b,c,d){return new function(){var e=this;e.canViewFeedback=!1,e.canDownload=!1;var f=function(b){a(document).ready(function(){for(var c in b){var d=b[c],f=a("#module-"+c+" .activityinstance"),h={isimage:!1,fileid:d,url:a(f).attr("href"),canviewfeedback:e.canViewFeedback,candownload:e.canDownload,html:'<span id="content-target-'+d+'"></span>'};g(h,d,c)}})},g=function(c,d,e){b.render("filter_ally/wrapper",c).done(function(b){var c=a("#module-"+e+" .activityinstance");a(c).after(b),a("#content-target-"+d).after(c),a("#content-target-"+d).remove()})};this.init=function(a,b,g){e.canViewFeedback=b,e.canDownload=g,Object.keys(ally_module_maps.file_resources).length>0&&(b||g)&&f(ally_module_maps.file_resources),c.init(a),d.init()}}});